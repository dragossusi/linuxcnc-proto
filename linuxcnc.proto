syntax = "proto3";

package linuxcnc;

import "proto/hal/pin.proto";
import "proto/hal/component.proto";
import "proto/status/task/task.proto";
import "proto/status/io/io.proto";
import "proto/status/jog/jog.proto";
import "proto/status/message/message.proto";
import "proto/status/motion/motion.proto";

option java_package = "ro.dragossusi.proto.linuxcnc";
option java_multiple_files = true;

service LinuxCnc {
  // status
  rpc ReadStatus(ReadStatusRequest) returns (CncStatus);

  // error
  rpc ReadError(ReadErrorRequest) returns (status.SystemMessage);

  rpc GetComponents(GetComponentsRequest) returns (GetComponentsResponse);

  rpc CreateComponent(CreateComponentRequest) returns (HalComponent);

  rpc GetPins(HalComponent) returns (GetPinsResponse);

  rpc CreatePin(CreatePinRequest) returns (HalPin);

  // commands
  rpc SetTaskMode(SetTaskModeRequest) returns (SendCommandResponse);
  rpc SetTaskState(SetTaskStateRequest) returns (SendCommandResponse);
  rpc TaskAbort(TaskAbortRequest) returns (SendCommandResponse);

  rpc HomeAxis(HomeAxisRequest) returns (SendCommandResponse);
  rpc UnhomeAxis(UnhomeAxisRequest) returns (SendCommandResponse);

  rpc OverrideLimits(OverrideLimitsRequest) returns (SendCommandResponse);

  rpc JogContinuous(JogContinuousRequest) returns (SendCommandResponse);
  rpc JogIncremental(JogIncrementalRequest) returns (SendCommandResponse);
  rpc JogAbsolute(JogAbsoluteRequest) returns (SendCommandResponse);
  rpc JogStop(JogStopRequest) returns (SendCommandResponse);
}

// error
message ReadErrorRequest{}

// command requests
message SetTaskModeRequest { status.TaskMode task_mode = 1; }
message SetTaskStateRequest { status.TaskState task_state = 1; }
message TaskAbortRequest {}

message HomeAxisRequest { int32 joint_number = 1; }
message UnhomeAxisRequest { int32 joint_number = 1; }

message OverrideLimitsRequest { int32 joint_number = 1; }

message JogContinuousRequest {
  status.JogMode jog_mode = 1;
  int32 joint_or_axis = 2;
  double velocity = 3;
}

message JogIncrementalRequest {
  status.JogMode jog_mode = 1;
  int32 joint_or_axis = 2;
  double velocity = 3;
  double stepSize = 4;
}

message JogAbsoluteRequest {
  status.JogMode jog_mode = 1;
  int32 joint_or_axis = 2;
  double velocity = 3;
  double position = 4;
}

message JogStopRequest {
  status.JogMode jog_mode = 1;
  int32 joint_or_axis = 2;
}

// command responses
message SendCommandResponse { int32 result = 1; }

// others
message ReadStatusRequest {}

message CncStatus {
  status.TaskStatus task_status = 1;
  status.MotionStatus motion_status = 2;
  status.IoStatus io_status = 3;
}

message GetComponentsRequest {
  // empty
}

message CreateComponentRequest { string name = 1; }

message CreatePinRequest {
  string component_id = 1;
  string name = 2;
  HalPinType type = 3;
  float value = 4;
}

message GetComponentsResponse { repeated HalComponent components = 1; }

message GetPinsResponse { repeated HalPin pins = 1; }